#!/bin/sh

if [ $# -eq 0 ] ; then
  set -- "Tags"
fi

module="$1"

rpmtag_h="$(mktemp)"

curl -L -so "${rpmtag_h}" https://github.com/rpm-software-management/rpm/raw/refs/heads/rpm-4.20.x/include/rpm/rpmtag.h

# Translate rpm's rpmtags.h tag #define's into something usable as ruby constants.
echo "# This file is automatically generated by the command:"
echo "# > $0 $module"
echo 
echo "module $module"
cat "${rpmtag_h}" | cc -E -o - - | grep '^ *RPMTAG.*= ' | sed -e 's/RPMTAG_//g; s/,$//' 2> /dev/null

# Add the rpmSigTag_e entries into a separate namespace. 
echo 
echo "  module $module::Signature"

# For whatever reason, rpmSigTag_e doesn't declare HEADERSIGNATURES, so let's make it ourselves.
echo "      HEADERSIGNATURES = ::${module}::HEADERSIGNATURES"

cat "${rpmtag_h}" | cc -E -o - - | grep '^ *RPMSIGTAG.*= ' \
  | sed -e 's/RPMSIGTAG_//g; s/,$//' \
  | sed -e 's/RPMTAG_/'${module}::'/g; s/,$//' \
  | sed -e 's/^/  /'
echo "  end"
echo "end"

rm "${rpmtag_h}"
